workflows:
  build-and-deploy:
    name: Build and Deploy
    environment:
      xcode: latest
    scripts:
      - name: Install CocoaPods dependencies
        script: |
          cd ios
          pod install
      - name: Build iOS app
        script: |
          xcodebuild -workspace MovieHub.xcworkspace -scheme MovieHub -configuration Release -archivePath $HOME/build/MovieHub.xcarchive archive
          xcodebuild -exportArchive -archivePath $HOME/build/MovieHub.xcarchive -exportPath $HOME/build/MovieHub.ipa -exportOptionsPlist ExportOptions.plist
          -destination 'platform=iOS Simulator,name=iPhone 14 Pro Max,OS=16.2' \
          clean build test CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO
    artifacts:
      - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.app
    publishing:
      email:
        recipients:
          - egifcb@gmail.com
